{% extends 'index.html' %}

{% block content %}
{{ super() }}
{% for cat, msg in get_flashed_messages(True) %}
<p>{{ msg }}</p>
{% endfor %}
<div class="information">
    <p>{{ tender['title'] }} </p>
    <p>Начальная цена: {{ tender['price']|float_to_currency }}</p>
    <p>Дата окончания подачи заявок: {{ tender['date'] }}</p>
</div>
<div class="action">
    <form action="/downloadDocs" method="post">
        <input type="hidden" name="id" value="{{ tender['href'] }}">
        <button class="custom-btn btn-10" type="submit">Скачать документы</button>
    </form>
</div>
{% if current_user.get_role() == 'director' %}
<div class="information">
    <div class="information">
        <div class='information'>
            <h3>СППР</h3>
            <p>Подсчитанная себестоимость: {{self_price}}</p>
            <p>Средняя оценка отделов: {{average_rate}}</p>
            <p>Целесообразность участия: {{reasonability}}</p>
            <h2>Решение СППР: {{support_decision}}</h2>
            <form action="/set_status" method="post">
                <input type="hidden" name="tender_id" value="{{ tender['id'] }}">
                <div class='center'>
                    <select class="my-input" name="status">
                        <option value="принято">Принять</option>
                        <option value="отклонено">Отклонить</option>
                        <option value="на рассмотрении">Отправить на рассмотрение</option>
                    </select>
                    <input class="my-input" type="submit" value="Установить статус"/>
                </div>
            </form>
        </div>
        <h3>Оценки отдела кадров</h3>
        <p><strong>Оценочная себестоимость:</strong> {{ hr_info['costprice'] }} </p>
        <p><strong>Оценка целесообразности участия в заявке:</strong> {{ hr_info['rate'] }} </p>
        <p><strong>Комментарий:</strong> {{ hr_info['comment'] }} </p>
    </div>
    <div class="information">
        <h3>Оценки отдела складского учета</h3>
        <p><strong>Оценочная себестоимость:</strong> {{ materials_info['costprice'] }} </p>
        <p><strong>Оценка целесообразности участия в заявке:</strong> {{ materials_info['rate'] }} </p>
        <p><strong>Комментарий:</strong> {{ materials_info['comment'] }} </p>
    </div>
    <div class="information">
        <h3>Оценки отдела инструментов и механизации</h3>
        <p><strong>Оценочная себестоимость:</strong> {{ instruments_info['costprice'] }} </p>
        <p><strong>Оценка целесообразности участия в заявке:</strong> {{ instruments_info['rate'] }} </p>
        <p><strong>Комментарий:</strong> {{ instruments_info['comment'] }} </p>
    </div>
</div>
{% else %}
<div class="action">
    <form action="/rate_tender" method="post">
        <div class="information">
            <input type="hidden" name="tender_id" value="{{ tender['id'] }}">
            <label for="costprice">Оценочная себестоимость:</label>
            <input type="text" id='costprice' name='costprice'
                   onkeypress="return event.charCode >= 48 && event.charCode <= 57"
                   value="{{Null if rate_info['costprice'] == None else rate_info['costprice']}}"/>
            <p><label>Оценка:</label>
                {% if rate_info['rate'] == 9 %}
                <input type="radio" name="rating" value="9" checked> Отлично
                {% else %}
                <input type="radio" name="rating" value="9"> Отлично
                {% endif %}

                {% if rate_info['rate'] == 7 %}
                <input type="radio" name="rating" value="7" checked> Выше среднего
                {% else %}
                <input type="radio" name="rating" value="7"> Выше среднего
                {% endif %}

                {% if rate_info['rate'] == 5 %}
                <input type="radio" name="rating" value="5" checked> Средне
                {% else %}
                <input type="radio" name="rating" value="5"> Средне
                {% endif %}

                {% if rate_info['rate'] == 3 %}
                <input type="radio" name="rating" value="3" checked> Ниже среднего
                {% else %}
                <input type="radio" name="rating" value="3"> Ниже среднего
                {% endif %}

                {% if rate_info['rate'] == 1 %}
                <input type="radio" name="rating" value="1" checked> Плохо
                {% else %}
                <input type="radio" name="rating" value="1"> Плохо
                {% endif %}

            </p>
            <p><label>Комментарий:</label></p>
            <p><textarea name="comment" rows=20 cols=100> {{ "" if rate_info['comment'] == None else rate_info['comment']}}</textarea>
                {% if tender['status'] == "на рассмотрении"%}
            <p><input type="submit" value="Оценить"/>
                {% else %}
            <p><input type="submit" value="Оценить" disabled/>
                {% endif %}
        </div>
    </form>
</div>
{% endif %}

{% endblock %}